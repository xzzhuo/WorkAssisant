
<#include "template_header.html">

<script type="text/javascript" src="js/jquery.form.js"></script>
<script type="text/javascript" src="js/my-util.js"></script>

<script language="javascript">
$(document).ready(function(){
	
	$("#image_photo").click(function(){
		$("#user_photo").click();
	});
	
	$("#select_file").click(function(){
		$("#user_photo").click();
	});
	
	$("#user_photo").change(function(){
		// update photo
		
		var f = document.getElementById('user_photo').files[0];
		var src = null;
		try
		{
			src = window.webkitURL.createObjectURL(f);
		}
		catch (e)
		{
			try
			{
				src = window.URL.createObjectURL(f);
			}
			catch (e)
			{
				
			}
		}
		document.getElementById('image_photo').src = src;
	});
	
});
</script>

<script language="javascript">
$(document).ready(function(){

	lang_error_file_size 			= "${LANG['lang_error_file_size']}";
	
	regexp_phone = /^1[0-9]{10}$/,
	tips = $("#validateTips");

	function updateTips(t) {
		tips.text(t);
		tips.text(t).addClass("text-danger");
		setTimeout(function() {
			tips.removeClass( "text-danger", 1500 );
		}, 500 );
    }

	function checkRegexp( o, regexp, n ) {
		if ( !( regexp.test( o.val() ) ) ) {
			updateTips( n );
			o.focus();
			return false;
		} else {
			return true;
		}
	}
	
	function checkFile( id, limit, t ) {
		var f = document.getElementById(id).files[0];

		if ( f.size > limit ) {
			updateTips( t + ": " + limit/1024 + "KB");
			return false;
		} else {
			return true;
		}
	}

	var options = {
		url: 'ajax.html',
		type: 'post',
		data: {
			act				: "act_image_add",
	    	role_uuid		: "${role_uuid}",
	    	account_uuid	: "${current_account}",
	    	image_content 	: $("#image_content").val();,
	    	
	    	random			: Math.random()
        },
		beforeSubmit: function(a,f,o) {
			var valid = true;

		    var user_photo = $("#user_photo").val();
		    
		    updateTips("");

			if (user_photo.length > 0)
			{
				valid = valid && checkFile( 'user_photo', 1024*1024, lang_error_file_size );
			}
			
			if (!valid)
			{
				return valid;
			}
		},
		success: function (data) {
			var retval = JSON.parse(data);
    		if (retval.result == "OK")
    		{
    			updateTips("${LANG['lang_update_success']}");
    		}
    		else
    		{
    			updateTips(retval.message);
    		}
		}
	};
	

	$('#submit_update_profile').ajaxForm(options);
	
});
</script>

	<#include "template_menu.html">
	
	<div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h4 class="page-header"></h4>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        ${LANG["lang_user_profile"]}
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                    	<form id="submit_update_profile" enctype ="multipart/form-data">
	                        <div class="dataTable_wrapper">
	                        
								<!--<table class="table table-hover">-->
								<table class="table table-striped table-bordered table-hover">
	                                <tbody>
	                                    <tr>
	                                        <td colspan="2">
	                                    		<div style="width: 200px;height: auto;max-height:150px;">
	                                        		<img id='image_photo' style="width: 100%;height: auto;max-height: 140px;" src="./image/photo.jpg" alt="" />
	                                        	</div>
	                                        	<div>
		                                        	<span>
		                                        		<button type="button" class="btn btn-info" id="select_file">${LANG["lang_select_file"]}</button>
		                                        		<input type="file" id="user_photo" name="photo" style="display:none" accept="image/*" value="">
		                                        	</span>
		                                        </div>
	                                        </td>
										</tr>
	                                    <tr>
	                                        <td>${LANG["lang_image_content"]}</td>
	                                        <td><input class="form-control" placeholder="${LANG['lang_image_content']}" name="image_content" id="image_content"></td>
	                                    </tr>
	                                    <tr>
	                                    	<td colspan="2" style="vertical-align:middle;">
	                                    		<p class="text-primary" id="validateTips"></p>
	                                    	</td>
	                                    </tr>
	                                </tbody>
	                            </table>
	
							</div>
	                        <!-- /.table-responsive -->
	                        <div class="well">
	                        	<div class="tablearea-set" style="text-align:right;">
	                            	<button type="submit" class="btn btn-outline btn-primary" id="submit_update_profile">${LANG["lang_submit"]}</button>
	                            </div>
	                        </div>
                        </form>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->

    </div>
    <!-- /#page-wrapper -->
                    
<#include "template_footer.html">
