
<#include "template_header.html">

<script language="javascript">
$(document).ready(function(){

	lang_role =	"${LANG['lang_role']}";
	err_length_must 		= "${LANG['lang_err_length_must']}"	

	tips = $("#validateTips");

	function updateTips(t) {
		tips.text(t);
		tips.text(t).addClass("text-danger");
		setTimeout(function() {
			tips.removeClass( "text-danger", 1500 );
		}, 500 );
    }

    function checkLength( o, n, min, max ) {
		if ( o.val().length > max || o.val().length < min ) {
			updateTips( n + err_length_must + min + " - " + max + "." );
			// [delete] updateTips( "Length of " + n + " must be between " + min + " and " + max + "." );
			o.focus();
			return false;
		} else {
			return true;
		}
	}

	$("#submit_add_role").click(function(){
    	var valid = true;

		var role_name = $("#role_name").val();
	    var role_type = $("#role_type").val();
	    var leader_uuid = $("#role_leader").val();
	    var current_account_uuid = "${current_account_uuid}";
	    var visible_type = $("#visible_type").val();
	    var access_type = $("#access_type").val();
	    var censorship_type = $("#censorship_type").val();
		var role_desc = $("#role_desc").val();

		valid = valid && checkLength( $("#role_name"), lang_role, 1, 80);
		
		if (!valid)
		{
			return valid;
		}

	    $.post("role_list.html",
	    {
	    	act		: "act_add_role",
	    	name	: role_name,
	    	type 	: role_type,
	    	leader_uuid	: leader_uuid,
	    	current_account_uuid : current_account_uuid,
	    	visible 	: visible_type,
	    	access		: access_type,
	    	censorship  : censorship_type,
	    	role_desc 	: role_desc,
	    	random		: Math.random()
	    }, function(data, status)
	    {
	    	if (status == "success")
	    	{
	    		var retval = JSON.parse(data);
	    		if (retval.result == "OK")
	    		{
	    			window.location.href="role_list.html?act=menu_show_role_list";
	    		}
	    		else
	    		{
	    			updateTips(retval.message);
	    		}
	    	}
	    });
	});
	
});
</script>

<style type="text/css">  
    #search  
    {  
        left: 0;  
        position: relative;  
    }  
    #auto_div  
    {  
        display: none;  
        width: 300px;  
        border: 1px #74c0f9 solid;  
        background: #FFF;  
        position: absolute;  
        top: 24px;  
        left: 0;  
        color: #323232;  
    }
</style>
    
<script type="text/javascript">  
	var old_value = "";
	var highlightindex = -1;

	function getDataList(div,input,auto) {
		var current_account_uuid = "${current_account_uuid}";
		var keyword = $("#"+input).val();
		$.post("ajax.html",
	    {
	    	act		: "act_search_account_list",
	    	keyword	: keyword,
	    	account : current_account_uuid,
	    	random		: Math.random()
	    }, function(data, status)
	    {
	    	if (status == "success")
	    	{
	    		var retval = JSON.parse(data);
	    		if (retval.result == "OK")
	    		{
	    			AutoComplete(auto, input, retval.message);
	    		}
	    		else
	    		{
	    			updateTips(retval.message);
	    		}
	    	}
	    });
	} 

	function AutoComplete(auto, input, mylist) {  
	    if ($("#" + input).val() != old_value || old_value == "") {  
	        var autoNode = $("#" + auto);
	        var carlist = new Array();  
	        var n = 0;  
	        old_value = $("#" + input).val();  
	        for (i in mylist) {  
	            if (mylist[i].indexOf(old_value) >= 0) {  
	                carlist[n++] = mylist[i];  
	            }  
	        }  
	        if (carlist.length == 0) {  
	            autoNode.hide();  
	            return;  
	        }  
	        autoNode.empty();
	        for (i in carlist) {
	            var wordNode = carlist[i];
	            var newDivNode = $("<div>").attr("id", i);
	            newDivNode.attr("style", "font:14px/25px arial;height:25px;padding:0 8px;cursor: pointer;");  
	            newDivNode.html(wordNode).appendTo(autoNode);
 
	            newDivNode.mouseover(function () {  
	                if (highlightindex != -1) {
	                    autoNode.children("div").eq(highlightindex).css("background-color", "white");  
	                }  

	                highlightindex = $(this).attr("id");  
	                $(this).css("background-color", "#ebebeb");  
	            });  
	            newDivNode.mouseout(function () {  
	                $(this).css("background-color", "white");  
	            });  

	            newDivNode.click(function () {  
	                var comText = autoNode.hide().children("div").eq(highlightindex).text();  
	                highlightindex = -1;  
	                $("#" + input).val(comText);  
	            })  
	            if (carlist.length > 0) {
	                autoNode.show();  
	            } else {
	                autoNode.hide();  
	                highlightindex = -1;  
	            }  
	        }  
	    }  

	    document.onclick = function (e) {  
	        var e = e ? e : window.event;  
	        var tar = e.srcElement || e.target;  
	        if (tar.id != input) {  
	            if ($("#" + auto).is(":visible")) {  
	                $("#" + auto).css("display", "none")  
	            }  
	        }  
	    }  
	}
        
    </script>
    
	<#include "template_menu.html">
	
	<div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h4 class="page-header"></h4>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        ${LANG["lang_role_add"]}
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="dataTable_wrapper">
                        
							<table class="table table-striped table-bordered table-hover">
                                <tbody>
                                    <tr>
                                        <td>${LANG["lang_role_name"]}</td>
                                        <td><input class="form-control" placeholder="${LANG['lang_role_name']}" id="role_name" autofocus="autofocus"></td>
									</tr>
                                    <tr>
                                        <td>${LANG["lang_role_type"]}</td>
                                        <td>
                                        	<select class="form-control" id="role_type">
<#list role_type_list as value>
                                                <option value="${value.template_type}">${value.template_type_name}</option>
</#list>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>${LANG["lang_role_leader"]}</td>
                                        <td>
                                            <div class="search" id="search">
                                            	<input class="form-control" placeholder="${LANG['lang_role_leader']}" id="role_leader" onkeyup="getDataList('search', this.id , 'auto_div')" onfocus="getDataList('search', this.id , 'auto_div')">
										        <div id="auto_div">  
										        </div>  
										    </div>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td>${LANG["lang_visible_type"]}</td>
                                        <td>
                                        	<select class="form-control" id="visible_type">
<#list visible_type_list as value>
                                                <option value="${value}">${LANG[value]!LANG["lang_unknown"]}</option>
</#list>
                                            </select>
                                        </td>
                                    </tr>
                                    
									<tr>
                                        <td>${LANG["lang_access_type"]}</td>
                                        <td>
                                        	<select class="form-control" id="access_type">
<#list access_type_list as access_value>
                                                <option value="${access_value}">${LANG[access_value]!LANG["lang_unknown"]}</option>
</#list>
                                            </select>
                                        </td>
                                    </tr>

									<tr>
                                        <td>${LANG["lang_censorship_type"]}</td>
                                        <td>
                                        	<select class="form-control" id="censorship_type">
<#list censorship_type_list as censorship_value>
                                                <option value="${censorship_value}">${LANG[censorship_value]!LANG["lang_unknown"]}</option>
</#list>
                                            </select>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td>${LANG["lang_description"]}</td>
                                        <td><input class="form-control" placeholder="${LANG['lang_description']}" id="role_desc"></td>
									</tr>
									
                                    <tr>
                                    	<td colspan="2">
                                    		<p class="text-primary" id="validateTips">${LANG["lang_role_name_required"]}</p>
                                    	</td>
                                    </tr>
                                </tbody>
                            </table>

						</div>
                        <!-- /.table-responsive -->
                        <div class="well">
                        	<div class="tablearea-set" style="text-align:right;">
                            	<button type="button" class="btn btn-outline btn-primary" id="submit_add_role">${LANG["lang_submit"]}</button>
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->

    </div>
    <!-- /#page-wrapper -->
                    
<#include "template_footer.html">

    